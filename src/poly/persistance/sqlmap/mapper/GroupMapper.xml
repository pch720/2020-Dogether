<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="poly.persistance.mapper.IGroupMapper">
	<!-- 그룹명 중복확인 -->
	<select id="GnCheck" parameterType="String" resultType="String">
		SELECT COUNT(*)
		FROM GG
		WHERE
			GROUP_NAME=#{GroupName}
	</select>
	<!--그룹 및 목표 만들기-->
    <insert id="MakeGG" parameterType="GroupDTO">
		INSERT
		INTO GG
		(
			GROUP_NAME,
			MAKE_DT,
			MAKE_ID,
			GREETING,
		 	FUNCTION,
		    COUNT
		)
		VALUES
		(
			#{groupName},
			SYSDATE(),
			#{userName},
		 	#{greeting},
			#{function},
			'1'
		)
	</insert>
    <!--만든 사람을 관리자로 넣어주기-->
    <insert id="MkGG" parameterType="GroupDTO">
		INSERT
		INTO GROUPUSER
		(
			USER_NAME,
			GREG_DT,
			GROUP_NAME,
			GAUTH,
			FUNCTION
		)
		VALUES
		(
			#{userName},
			SYSDATE(),
			#{groupName},
			#{auth},
			#{function}
		)
	</insert>
	<!--그룹 정보 가져오기-->
	<select id="getgg" parameterType="GroupDTO" resultType="GroupDTO">
		SELECT
		GG.GROUP_SEQ as GroupSeq,
		GG.GROUP_NAME as GroupName,
		GG.GREETING as Greeting,
		GG.FUNCTION as function
		FROM GG AS GG
		WHERE GG.GROUP_NAME IN(
		SELECT
		GU.GROUP_NAME
		FROM GROUPUSER AS GU
		WHERE GU.USER_NAME = #{userName}
		AND GU.FUNCTION = #{function}
		)
	</select>
	<delete id="Delgu" parameterType="GroupDTO">
		DELETE
		 FROM GROUPUSER
		 WHERE(
		 USER_NAME = #{userName}
		 AND
		 GROUP_NAME = #{GroupName}
		 )
	</delete>
	<!--이미있는지확인-->
	<select id="already" parameterType="GroupDTO" resultType="String">
		SELECT COUNT(*)
		FROM GROUPUSER
		WHERE
			GROUP_NAME=#{GroupName}
			AND
			USER_NAME=#{userName}
	</select>
</mapper>